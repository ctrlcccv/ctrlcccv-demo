<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ìŠ¤í¬ë¡¤ í•˜ë©´ ìœ íŠœë¸Œ ìë™ì¬ìƒ, Intersection Observerë¡œ êµ¬í˜„í•˜ëŠ” 4ë‹¨ê³„ ì™„ì„± ê°€ì´ë“œ | ì»¨íŠ¸ë¡¤ + CCCV</title>
<meta name="description" content="ìŠ¤í¬ë¡¤ í•˜ë©´ ìœ íŠœë¸Œ ìë™ì¬ìƒ, Intersection Observerë¡œ êµ¬í˜„í•˜ëŠ” 4ë‹¨ê³„ ì™„ì„± ê°€ì´ë“œ | ì»¨íŠ¸ë¡¤ + CCCV" />
<meta name="robots" content="noindex">
<link rel="shortcut icon" href="https://ctrlcccv.github.io/favicon.png">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&amp;display=swap" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
<style>
    * {margin: 0;padding: 0;font-family: 'Noto Sans KR', sans-serif;box-sizing: border-box;box-sizing: border-box;}
    .blog { display: flex; justify-content: center; align-items: center; position: fixed; bottom:50px; left: 50%; width: 160px; height: 46px; background-size: 300% 100%; border-radius:23px; font-size: 16px; font-weight: 500; color: #fff; z-index: 100; background-image: linear-gradient(to right, #29323c, #485563, #2b5876, #4e4376); transform: translate(-50%,0); text-decoration: none; transition: all .4s ease-in-out; } 
    .blog:hover { background-position: 100% 0; box-shadow: 0 2px 8px 0 rgba(45, 54, 65, 0.65); } 

    .con { display: flex; justify-content: center; align-items: center; height: 100vh; background: #8ab4f8; font-size: 48px; font-weight: 700; text-align: center; } 
    .video { 
        position: relative; 
        width: 100%; 
        max-width: 854px; 
        aspect-ratio: 16/9; 
        margin: 50px auto;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    } 
    .player { position: absolute; top: 0; left: 0; width: 100%; height: 100%; } 
    
    /* ë¡œë”© ì¸ë””ì¼€ì´í„° ì¶”ê°€ */
    .video::before {
        content: 'ë¡œë”©ì¤‘...';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0,0,0,0.8);
        color: white;
        padding: 10px 20px;
        border-radius: 4px;
        font-size: 14px;
        z-index: 1;
        opacity: 0;
        transition: opacity 0.3s;
    }
    
    .video.loading::before {
        opacity: 1;
    }
</style>
</head>
<body>
    <div class="con">
        ìŠ¤í¬ë¡¤ì„ ë‚´ë ¤ì„œ ìœ íŠœë¸Œ ë™ì˜ìƒì˜<br>ìë™ì¬ìƒì„ í™•ì¸í•´ë³´ì„¸ìš”.<br>
    </div>
    <div class="video" data-video-id="rJe_YsLJqUY">
        <div class="player"></div>
    </div>
    <div class="video" data-video-id="rJe_YsLJqUY">
        <div class="player"></div>
    </div>

    <a href="https://ctrlcccv.github.io/code/2025-06-16-youtube-autoplay/" class="blog" target="_blank">ì»¨íŠ¸ë¡¤ + CCCV</a>

<script>
    // YouTube APIê°€ ì´ë¯¸ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê³ , ì—†ìœ¼ë©´ ë™ì ìœ¼ë¡œ ë¡œë“œ
    function loadYouTubeAPI() {
        return new Promise((resolve) => {
            if (window.YT && window.YT.Player) {
                resolve();
                return;
            }
            
            window.onYouTubeIframeAPIReady = resolve;
            
            if (!document.querySelector('script[src*="youtube.com/iframe_api"]')) {
                const tag = document.createElement('script');
                tag.src = "https://www.youtube.com/iframe_api";
                const firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
            }
        });
    }

    // í™”ë©´ì— ë³´ì´ëŠ” YouTube ë™ì˜ìƒì„ ìë™ìœ¼ë¡œ ì¬ìƒ/ì¼ì‹œì •ì§€í•˜ëŠ” í´ë˜ìŠ¤
    class YouTubeAutoPlayer {
        constructor() {
            this.videos = new Map(); // ë¹„ë””ì˜¤ ìš”ì†Œì™€ í”Œë ˆì´ì–´ ë§¤í•‘
            this.observer = null;    // í™”ë©´ ê°ì§€ë¥¼ ìœ„í•œ Observer
            this.init();
        }

        // í´ë˜ìŠ¤ ì´ˆê¸°í™” - ëª¨ë“  ì„¤ì •ì„ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰
        async init() {
            try {
                await loadYouTubeAPI(); // YouTube API ë¡œë“œ ëŒ€ê¸°
                this.collectVideoElements(); // ë¹„ë””ì˜¤ ìš”ì†Œë“¤ ìˆ˜ì§‘
                this.setupIntersectionObserver(); // Intersection Observer ì„¤ì •
                await this.initializePlayers(); // í”Œë ˆì´ì–´ë“¤ ì´ˆê¸°í™” 
                
                console.log('ğŸš€ YouTube Auto Player ì´ˆê¸°í™” ì™„ë£Œ! (ë‹¤ì¤‘ ì¬ìƒ ëª¨ë“œ)');
            } catch (error) {
                console.error('âŒ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
            }
        }

        // í˜ì´ì§€ì˜ ëª¨ë“  ë¹„ë””ì˜¤ ìš”ì†Œë¥¼ ì°¾ì•„ì„œ Mapì— ì €ì¥
        collectVideoElements() {
            const videoElements = document.querySelectorAll('.video[data-video-id]');
            
            videoElements.forEach(element => {
                const videoId = element.getAttribute('data-video-id');
                this.videos.set(element, {
                    videoId,             // YouTube ë™ì˜ìƒ ID
                    player: null,        // YouTube í”Œë ˆì´ì–´ ì¸ìŠ¤í„´ìŠ¤
                    isPlaying: false,    // í˜„ì¬ ì¬ìƒ ìƒíƒœ
                    isIntersecting: false // í™”ë©´ì— ë³´ì´ëŠ”ì§€ ì—¬ë¶€
                });
            });
        }

        // í™”ë©´ì— ë™ì˜ìƒì´ ë³´ì´ëŠ”ì§€ ê°ì§€í•˜ëŠ” Observer ì„¤ì •
        setupIntersectionObserver() {
            // Intersection Observer ì˜µì…˜ ì„¤ì •
            const options = {
                root: null, // ë·°í¬íŠ¸ë¥¼ ê¸°ì¤€ìœ¼ë¡œ
                rootMargin: '0px',
                threshold: 1.0 // 100% ë³´ì¼ ë•Œ ìë™ ì¬ìƒ
            };

            // í™”ë©´ì— ë“¤ì–´ì˜¤ê³  ë‚˜ê°€ëŠ” ê²ƒì„ ê°ì§€í•˜ëŠ” Observer ìƒì„±
            this.observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const videoData = this.videos.get(entry.target);
                    if (!videoData || !videoData.player) return;

                    videoData.isIntersecting = entry.isIntersecting;

                    // í™”ë©´ì— 100% ë³´ì´ë©´ ì¬ìƒ, ì•ˆ ë³´ì´ë©´ ì¼ì‹œì •ì§€
                    if (entry.isIntersecting && !videoData.isPlaying) {
                        this.playVideo(entry.target, videoData);
                    } else if (!entry.isIntersecting && videoData.isPlaying) {
                        this.pauseVideo(entry.target, videoData);
                    }
                });
            }, options);

            // ëª¨ë“  ë¹„ë””ì˜¤ ìš”ì†Œë¥¼ ê´€ì°° ì‹œì‘
            this.videos.forEach((data, element) => {
                this.observer.observe(element);
            });
        }

        // ëª¨ë“  ë¹„ë””ì˜¤ í”Œë ˆì´ì–´ë¥¼ ë™ì‹œì— ì´ˆê¸°í™”
        async initializePlayers() {
            const promises = Array.from(this.videos.entries()).map(([element, data]) => {
                return this.createPlayer(element, data);
            });

            await Promise.all(promises);
        }

        // ê°œë³„ YouTube í”Œë ˆì´ì–´ ìƒì„±
        createPlayer(element, data) {
            return new Promise((resolve, reject) => {
                const playerContainer = element.querySelector('.player');
                
                element.classList.add('loading'); // ë¡œë”© í‘œì‹œ

                try {
                    // YouTube í”Œë ˆì´ì–´ ìƒì„±
                    const player = new YT.Player(playerContainer, {
                        height: '100%',
                        width: '100%',
                        videoId: data.videoId,
                        playerVars: {
                            rel: 0,               // ê´€ë ¨ ë™ì˜ìƒ í‘œì‹œ ì•ˆí•¨
                            modestbranding: 1,    // YouTube ë¡œê³  ìµœì†Œí™”
                            controls: 1,          // ì»¨íŠ¸ë¡¤ í‘œì‹œ
                            showinfo: 0,          // ë™ì˜ìƒ ì •ë³´ í‘œì‹œ ì•ˆí•¨
                            iv_load_policy: 3     // ì£¼ì„ í‘œì‹œ ì•ˆí•¨
                        },
                        events: {
                            // í”Œë ˆì´ì–´ ì¤€ë¹„ ì™„ë£Œì‹œ
                            onReady: (event) => {
                                element.classList.remove('loading');
                                data.player = event.target;
                                
                                // ì´ë¯¸ í™”ë©´ì— ë³´ì´ëŠ” ìƒíƒœë¼ë©´ ë°”ë¡œ ì¬ìƒ
                                if (data.isIntersecting && !data.isPlaying) {
                                    this.playVideo(element, data);
                                }
                                
                                resolve();
                            },
                            // í”Œë ˆì´ì–´ ì˜¤ë¥˜ì‹œ
                            onError: (error) => {
                                element.classList.remove('loading');
                                console.error('âŒ í”Œë ˆì´ì–´ ì˜¤ë¥˜:', error);
                                reject(error);
                            },
                            // í”Œë ˆì´ì–´ ìƒíƒœ ë³€ê²½ì‹œ (ì¬ìƒ, ì¼ì‹œì •ì§€, ì¢…ë£Œ ë“±)
                            onStateChange: (event) => {
                                // ë™ì˜ìƒ ì¢…ë£Œì‹œ ìë™ìœ¼ë¡œ ë‹¤ì‹œ ì¬ìƒ (ë£¨í”„ íš¨ê³¼)
                                if (event.data === YT.PlayerState.ENDED && data.isIntersecting) {
                                    setTimeout(() => {
                                        event.target.seekTo(0);    // ì²˜ìŒìœ¼ë¡œ ë˜ê°ê¸°
                                        event.target.playVideo();  // ë‹¤ì‹œ ì¬ìƒ
                                    }, 1000);
                                }
                            }
                        }
                    });
                } catch (error) {
                    element.classList.remove('loading');
                    console.error('âŒ í”Œë ˆì´ì–´ ìƒì„± ì‹¤íŒ¨:', error);
                    reject(error);
                }
            });
        }

        // ë™ì˜ìƒ ì¬ìƒ ì‹œì‘
        playVideo(element, data) {
            if (!data.player || data.isPlaying) return;

            try {
                // ìë™ì¬ìƒ ì •ì±…ì„ ìœ„í•´ ìŒì†Œê±° í›„ ì¬ìƒ
                data.player.mute();
                data.player.playVideo();
                
                // ì¬ìƒ ìƒíƒœ ì—…ë°ì´íŠ¸
                data.isPlaying = true;
                element.setAttribute('data-playing', 'true');
                
                console.log('â–¶ï¸ ì¬ìƒ ì‹œì‘:', data.videoId, '| í˜„ì¬ ì¬ìƒ ì¤‘ì¸ ë™ì˜ìƒ ìˆ˜:', this.getPlayingVideosCount());
            } catch (error) {
                console.error('âŒ ì¬ìƒ ì‹¤íŒ¨:', error);
            }
        }

        // ë™ì˜ìƒ ì¼ì‹œì •ì§€
        pauseVideo(element, data) {
            if (!data.player || !data.isPlaying) return;

            try {
                data.player.pauseVideo();
                
                // ì¼ì‹œì •ì§€ ìƒíƒœ ì—…ë°ì´íŠ¸
                data.isPlaying = false;
                element.removeAttribute('data-playing');
                
                console.log('â¸ï¸ ì¼ì‹œì •ì§€:', data.videoId, '| í˜„ì¬ ì¬ìƒ ì¤‘ì¸ ë™ì˜ìƒ ìˆ˜:', this.getPlayingVideosCount());
            } catch (error) {
                console.error('âŒ ì¼ì‹œì •ì§€ ì‹¤íŒ¨:', error);
            }
        }

        // í˜„ì¬ ì¬ìƒ ì¤‘ì¸ ë™ì˜ìƒ ê°œìˆ˜ ë°˜í™˜
        getPlayingVideosCount() {
            let count = 0;
            this.videos.forEach((data) => {
                if (data.isPlaying) count++;
            });
            return count;
        }

        // í˜„ì¬ ì¬ìƒ ì¤‘ì¸ ëª¨ë“  ë™ì˜ìƒ ID ë°˜í™˜
        getPlayingVideoIds() {
            const playingIds = [];
            this.videos.forEach((data) => {
                if (data.isPlaying) {
                    playingIds.push(data.videoId);
                }
            });
            return playingIds;
        }

        // ì •ë¦¬ ë©”ì„œë“œ (í•„ìš”ì‹œ ì‚¬ìš©) - ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€
        destroy() {
            // Observer ì œê±°
            if (this.observer) {
                this.observer.disconnect();
            }
            
            // ëª¨ë“  í”Œë ˆì´ì–´ ì œê±°
            this.videos.forEach((data) => {
                if (data.player) {
                    data.player.destroy();
                }
            });
            
            // Map ì´ˆê¸°í™”
            this.videos.clear();
        }
    }

    // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í›„ ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', () => {
        // ë¸Œë¼ìš°ì €ê°€ Intersection Observer APIë¥¼ ì§€ì›í•˜ëŠ”ì§€ í™•ì¸
        if (!window.IntersectionObserver) {
            console.warn('âš ï¸ Intersection Observer APIë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.');
            // í´ë°±: ê¸°ì¡´ ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ ë°©ì‹ ì‚¬ìš© ê°€ëŠ¥
            return;
        }

        // YouTube Auto Player ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ë° ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
        window.youtubeAutoPlayer = new YouTubeAutoPlayer();
    });
</script>
</body>
</html>


