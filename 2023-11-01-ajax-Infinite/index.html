<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>jQuery - Ajax 무한 스크롤 예제 (Intersection Observer API 활용) | 컨트롤 + CCCV</title>
<meta name="description" content="jQuery - Ajax 무한 스크롤 예제 (Intersection Observer API 활용) | 컨트롤 + CCCV" />
<meta name="robots" content="noindex">
<link rel="shortcut icon" href="https://ctrlcccv.github.io/favicon.png">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&amp;display=swap" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
<style>
* {margin: 0;padding: 0;font-family: 'Noto Sans KR', sans-serif;box-sizing: border-box;box-sizing: border-box;}
body {}
.container { width: 500px;height: 250px;margin: 150px auto 0;background: #fff;border: 1px solid #ededed;border-radius:6px;overflow-x: hidden;overflow-y: auto;} 
.item {padding: 10px 15px;font-size: 16px;}
.item + .item {border-top: 1px solid #ededed;}
</style>
</head>

<body>
<div class="container"></div>

<script>
$(document).ready(function() {
    let page = 1;
    const itemsPerPage = 10;
    const itemContainer = '.container';
    const itemClass = 'item'; 
    let lastItem;
    let lastObservedItem; 

    function loadItems() {
        $.ajax({
            url: `https://raw.githubusercontent.com/ctrlcccv/ctrlcccv-demo/main/2023-11-01-ajax-Infinite/test.json`,
            method: 'GET',
            dataType: 'json',
            success: function (data) {
                const newData = data.slice((page - 1) * itemsPerPage, page * itemsPerPage);
                newData.forEach(newItem => {
                    $(`${itemContainer}`).append(`<div class="${itemClass}">${newItem.item}</div>`);
                });
                page++;

                lastItem = $(`${itemContainer} .${itemClass}:last`)[0];
                if (lastItem !== lastObservedItem) {
                    observer.observe(lastItem);
                    lastObservedItem = lastItem;
                }
            },
            error: function (error) {
                console.error('데이터를 가져오는 동안 오류가 발생했습니다:', error);
            }
        });
    }

    loadItems();

    const observerOptions = {
        root: null,
        threshold: 0.5
    };

    const observer = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                lastObservedItem = $(`${itemContainer} .${itemClass}:last`)[0];
                loadItems();
                observer.unobserve(entry.target);
            }
        });
    }, observerOptions);
});


</script>
</body>
</html>
