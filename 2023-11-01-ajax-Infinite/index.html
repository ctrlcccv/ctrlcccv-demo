<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>jQuery - 스크롤 내리면 나타나는 애니메이션 | 컨트롤 + CCCV</title>
<meta name="description" content="jQuery - 스크롤 내리면 나타나는 애니메이션 | 컨트롤 + CCCV" />
<meta name="robots" content="noindex">
<link rel="shortcut icon" href="https://ctrlcccv.github.io/favicon.png">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&amp;display=swap" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
<style>
body {background: #ddd;}
.container {height: 150px;overflow-x: hidden;overflow-y: auto; width: 500px;margin: 0 auto;background: #fff;} 
.el {
    display: block;
    height: 100px;
    background-color: lightblue;
    margin-top: 200px; /* 요소가 초기에 화면 밖에 있도록 설정합니다. */
}
.el.active {background: red;}
</style>
</head>

<body>
    <div class="container">
        
    </div>

<script type="text/javascript" src="test.json"></script>
<script>
$(document).ready(function() {
    const data = JSON.parse(JSON.stringify(itemData));
    let page = 1;
    const itemsPerPage = 10; // 한 번에 로드할 항목 수

    function loadItems() {
        // const startIndex = (currentPage - 1) * itemsPerPage;
        // const endIndex = startIndex + itemsPerPage;
        // const itemsToLoad = data.slice(startIndex, endIndex);
        // itemsToLoad.forEach(item => {
        //     $('.container').append(`<div class="item">${item.item}</div>`);
        // });
        // currentPage++;
        
        // AJAX를 사용하여 데이터를 가져오는 부분
        $.ajax({
            url: `https://raw.githubusercontent.com/ctrlcccv/ctrlcccv-demo/main/2023-11-01-ajax-Infinite/test.json`,
            method: 'GET',
            dataType: 'json',
            success: function (data) {
                // 데이터를 가져온 후 처리하는 부분
                const newData = data.slice((page - 1) * itemsPerPage, page * itemsPerPage);
                newData.forEach(item => {
                    $('.container').append(`<div class="item">${item.item}</div>`);
                });

                isLoading = false;
                page++;
            },
            error: function (error) {
                console.error('데이터를 가져오는 동안 오류가 발생했습니다:', error);
                isLoading = false;
            }
        });
        
    }

    loadItems();

    // Intersection Observer 설정
    const observerOptions = {
        root: null, // 루트 요소를 지정하지 않음
        threshold: 0.5 // 요소가 50% 이상 화면에 들어올 때 콜백 실행
    };

    const observer = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                // 요소가 화면에 들어올 때 새로운 항목 로드
                loadItems();
                lastItem = $('.container .item:last')[0];
                observer.observe(lastItem);
                observer.unobserve(entry.target); 
                console.log('이벤트 발생!')
                
            }
        });
    }, observerOptions);

    let lastItem = $('.container .item:last')[0];
    observer.observe(lastItem);
});

</script>
</body>
</html>
